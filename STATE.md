# Current State

## üöÄ Active Task
**–§–∏–∫—Å –º–µ—Ö–∞–Ω–∏–∫–∏ —Ç–∞–ø–æ–≤ (UX + —Ä–∞—Å—á—ë—Ç—ã) - –í–´–ü–û–õ–ù–ï–ù–û (05.01.2026)**

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–§–æ—Ä–º—É–ª–∞ —Å–∏–ª—ã —Ç–∞–ø–∞ –≤ StatusBar.tsx:**
   - –ë—ã–ª–æ: `1 + tap_bonus` (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –±–∞–∑–æ–≤—É—é —Å–∏–ª—É —Ç–∞–ø–∞)
   - –°—Ç–∞–ª–æ: `tap_power + tap_bonus` (–∫–∞–∫ –≤ SQL)
   - –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–∫–∏–Ω–µ +30 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç +31)

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TapBull.tsx (–ø–ª–∞–≤–Ω—ã–µ —Ç–∞–ø—ã):**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `onTouchStart` –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (—É–±–∏—Ä–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 300ms)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debounce 50ms (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö —Ç–∞–ø–æ–≤)
   - ‚úÖ Haptic Feedback —á–µ—Ä–µ–∑ Telegram WebApp API (–≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Ç–∞–ø–µ)
   - ‚úÖ `touchAction: 'manipulation'` –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–∫–ª–∏–∫–∞

3. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ Home.tsx:**
   - ‚úÖ –ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ú–ì–ù–û–í–ï–ù–ù–û (–Ω–µ –∂–¥—É—Ç —Å–µ—Ä–≤–µ—Ä–∞)
   - ‚úÖ –ü–ª–∞–≤–∞—é—â–µ–µ —á–∏—Å–ª–æ –≤—ã–ª–µ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É
   - ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

4. **TypeScript —Ç–∏–ø—ã:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `tap_power: number` –≤ `GameState` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - ‚úÖ –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ `StatusBar` —á–µ—Ä–µ–∑ props

### ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–ò–ú–ï–ù–ò–¢–¨ SQL:
**–§–∞–π–ª:** `fix_get_bull_game_state_tap_power.sql`

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞:**
1. –û—Ç–∫—Ä–æ–π Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `fix_get_bull_game_state_tap_power.sql`
3. –í—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–∏–ª–∞—Å—å: `SELECT * FROM get_bull_game_state('190202791')`

### ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (–ü–†–û–í–ï–†–ò–¢–¨ –ü–û–°–õ–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø SQL):
- [ ] –¢–∞–ø—ã –ø–ª–∞–≤–Ω—ã–µ (–Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏, –º–æ–∂–Ω–æ —Ç–∞–ø–∞—Ç—å –±—ã—Å—Ç—Ä–æ)
- [ ] –¢–µ–ª–µ—Ñ–æ–Ω –≤–∏–±—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏ —Ç–∞–ø–µ (haptic feedback)
- [ ] StatusBar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ü–∏—Ñ—Ä—É (tap_power + tap_bonus)
- [ ] –ë–∞–ª–∞–Ω—Å —Ä–∞—Å—Ç—ë—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–Ω–µ –∂–¥—ë—Ç —Å–µ—Ä–≤–µ—Ä–∞)
- [ ] –≠–Ω–µ—Ä–≥–∏—è —Ç—Ä–∞—Ç–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üîß –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/types/index.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `tap_power` –≤ GameState
- `src/components/StatusBar.tsx` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞
- `src/components/TapBull.tsx` ‚Äî touch —Å–æ–±—ã—Ç–∏—è + haptic + debounce
- `src/pages/Home.tsx` ‚Äî –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `fix_get_bull_game_state_tap_power.sql` ‚Äî SQL –º–∏–≥—Ä–∞—Ü–∏—è

---

## üìå Previous Task
**Phase 1: Session Management & Security Hardening**

### üìã To Do
- [ ] Implement User Session Management
- [ ] Security Hardening (RLS policies)

---

## üìå Previous Task
**Live Arena 4 —ç—Ç–∞–ø–∞ ‚Äî –ò–°–ü–†–ê–í–õ–ï–ù–û (05.01.2026)**

### ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω LiveArenaTestPage.tsx** ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/live-test` –¥–ª—è –¥–µ–º–æ 4—Ö —ç—Ç–∞–ø–æ–≤
- **giveaway-engine.ts** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
  - `tour1.participants: DrawParticipant[]` (–±—ã–ª–æ numbers)
  - `tour2.finalists: DrawParticipant[]` (–±—ã–ª–æ numbers)
  - `semifinal.eliminated: {ticket_number, username, place}[]` (–±—ã–ª–æ numbers)
  - `semifinal.finalists3: DrawParticipant[]` (–±—ã–ª–æ numbers)
- **LiveArenaPage.tsx** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã DrawResults –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **Build** ‚Äî —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç

### ‚è≥ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
1. `/live-test` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å mock –¥–∞–Ω–Ω—ã–º–∏ (4 –∫–Ω–æ–ø–∫–∏: Drum, Squeeze, Traffic, Final)
2. –°–æ–∑–¥–∞–π —Ä–æ–∑—ã–≥—Ä—ã—à ‚Üí –î–æ–±–∞–≤—å 5+ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Üí "–ü—Ä–æ–≤–µ—Å—Ç–∏" ‚Üí –û—Ç–∫—Ä–æ–π Live Arena
3. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 4 —ç—Ç–∞–ø–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—ã (05.01.2026):
- **–ö–Ω–æ–ø–∫–∞ LIVE** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (—Ä—è–¥–æ–º —Å "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã")
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** ‚Äî —Å—Ç–∞—Ä—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–æ—Ä–º–∞—Ç" –≤–º–µ—Å—Ç–æ –∫—Ä–∞—à–∞

### ‚úÖ MAJOR FIX: Live Arena –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ (05.01.2026)
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ —Å –ª–∞–≥–∞–º–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏:
- **Tour1Drum** ‚Äî —É–≤–µ–ª–∏—á–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª 50ms‚Üí100ms, —É–ø—Ä–æ—â–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏
- **Tour2Squeeze** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ-—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç (300ms –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏)
- **SemifinalTraffic** ‚Äî –ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω, —Ç–µ–ø–µ—Ä—å –∞–Ω–∏–º–∏—Ä—É–µ—Ç —Å–ø–∏–Ω—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏
- **FinalBattle** ‚Äî –ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω, —Ç–µ–ø–µ—Ä—å –∞–Ω–∏–º–∏—Ä—É–µ—Ç —Ö–æ–¥—ã —Å —Ä—É–ª–µ—Ç–∫–æ–π
- **–í–µ—Ä—Å—Ç–∫–∞** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω pt-[100px] –¥–ª—è Tour1

---

## üìå Previous Task
**CRITICAL BUG FIX: –†–æ–∑—ã–≥—Ä—ã—à + –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤ - –ò–°–ü–†–ê–í–õ–ï–ù–´**

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ & –ü—Ä–∏–º–µ–Ω–µ–Ω–æ (05.01.2026)
- **SQL Migration:** `buy_giveaway_ticket_v2` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞.
- **Overload Fix:** –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å UUID, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–∫–∏ "best candidate".
- **Schema Alignment:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `column telegram_id does not exist` (—É–¥–∞–ª–µ–Ω–∞ –ª–∏—à–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞).
- **Currency Fix:** –î–æ–±–∞–≤–ª–µ–Ω `currency: 'AR'` –≤ INSERT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–æ—à–∏–±–∫–∞ NOT NULL).
- **Cleanup:** –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –±–∏–ª–µ—Ç—ã (1558 —à—Ç), —Å–±—Ä–æ—à–µ–Ω—ã —Å—á—ë—Ç—á–∏–∫–∏.
- **Auto-delete:** –°–æ–∑–¥–∞–Ω–∞ `admin_complete_giveaway` —Å –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ–º –±–∏–ª–µ—Ç–æ–≤ –ø–æ—Å–ª–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞.
- **Frontend:** Build fixed and deployed (LiveArenaPage, SemifinalTraffic).
- **Status:** –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%.
- **Validation:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —á–µ—Ä–µ–∑ SQL –ø—Ä–æ–±—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞.

### ‚úÖ –§–∏–∫—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (05.01.2026)
- **–ü—Ä–æ–±–ª–µ–º–∞ 1:** `Could not find relationship between giveaway_tickets and users`
  - –§–∏–∫—Å: GiveawayManager.tsx —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç —Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ JOIN
- **–ü—Ä–æ–±–ª–µ–º–∞ 2:** `column winners is of type jsonb but expression is of type text[]`
  - –§–∏–∫—Å: `admin_complete_giveaway` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `to_jsonb(p_winners)`
- **–ü—Ä–æ–±–ª–µ–º–∞ 3:** `function array_length(jsonb, integer) does not exist`
  - –§–∏–∫—Å: `distribute_giveaway_prizes` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `jsonb_array_length()` –∏ `->>` –≤–º–µ—Å—Ç–æ –º–∞—Å—Å–∏–≤–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
  - –§–∏–∫—Å: `generate_giveaway_result` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç winners –≤ jsonb —á–µ—Ä–µ–∑ `to_jsonb()`
- **Status:** –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Å—Ç–∏" –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å

### ‚è≥ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
1. –°–æ–∑–¥–∞–π —Ä–æ–∑—ã–≥—Ä—ã—à –≤ Admin Panel
2. –ù–∞–∂–º–∏ "–ü—Ä–æ–≤–µ—Å—Ç–∏"
3. –û—Ç–∫—Ä–æ–π Live Arena ‚Äî —É–≤–∏–¥–∏—à—å –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ (–∫–∞–∫ —Ñ—É—Ç–±–æ–ª –≤ –ø–æ–≤—Ç–æ—Ä–µ)

---

## üìå Previous Task
**–†—É—á–Ω–∞—è –≤—ã–¥–∞—á–∞ –±–∏–ª–µ—Ç–æ–≤ (CRM) - –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û**

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ & –ü—Ä–∏–º–µ–Ω–µ–Ω–æ (05.01.2026)
- **SQL Migration:** `admin_add_ticket` RPC applied via automation script
- **Status:** Function exists in database
- **UI:** Visible in CRM Profile


---

## üìå Previous Task
**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ò–°–ü–†–ê–í–õ–ï–ù–ê**

### ‚úÖ –§–∏–∫—Å —Ç—Ä–∏–≥–≥–µ—Ä–∞ (04.01.2026)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ INSERT –≤ `users` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ç—Ä–∏–≥–≥–µ—Ä `trigger_auto_grant_starter`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏—é `auto_grant_starter_location()`. –§—É–Ω–∫—Ü–∏—è –ø—ã—Ç–∞–ª–∞—Å—å –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `user_locations` —Å –∫–æ–ª–æ–Ω–∫–æ–π `location_id`, –Ω–æ —Ç–∞–∫–æ–π –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç ‚Äî –µ—Å—Ç—å `location_slug`.
- **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω —Ç—Ä–∏–≥–≥–µ—Ä `trigger_auto_grant_starter` –∏ —Ñ—É–Ω–∫—Ü–∏—è `auto_grant_starter_location()`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** API `/api/upsert-user` —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è

---

## üìå Previous Task
**Giveaway —Å–∏—Å—Ç–µ–º–∞ - –ì–û–¢–û–í–ê**

### ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ Supabase (04.01.2026)
- **SQL —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π:**
  - `generate_giveaway_result(p_giveaway_id)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (20‚Üí5‚Üíwinners)
  - `distribute_giveaway_prizes(p_giveaway_id)` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–æ–≤ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º
  - `run_giveaway_draw(p_giveaway_id)` - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è + —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
  - –ö–æ–ª–æ–Ω–∫–∏: `draw_results`, `winners`, `prizes_distributed`

### ‚è≥ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
1. –°–æ–∑–¥–∞–π —Ä–æ–∑—ã–≥—Ä—ã—à –≤ Admin Panel ‚Üí Giveaways
2. –ù–∞–∂–º–∏ "–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–æ–∑—ã–≥—Ä—ã—à"
3. –î–æ–ª–∂–Ω–æ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üìå Previous Task
**–§–∏–∫—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Mini App + UsersTab —É–¥–∞–ª–µ–Ω–∏–µ**

### üîç –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –ü–æ—á–µ–º—É —Ç–æ–ª—å–∫–æ 17 —é–∑–µ—Ä–æ–≤?

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑—ã:**
- `users` (Mini App): **14** –∑–∞–ø–∏—Å–µ–π (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º)
- `bot_users` (–±–æ—Ç): **1527** –∑–∞–ø–∏—Å–µ–π

**–ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∞ `Users can update own profile` —Ç—Ä–µ–±—É–µ—Ç `auth.uid() = id`
- –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram Auth, –Ω–µ Supabase Auth ‚Üí `auth.uid()` = NULL
- INSERT —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–µ—Ä–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ), –Ω–æ UPDATE –ø–∞–¥–∞–µ—Ç (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤–∏–∑–∏—Ç—ã)

**–§–∏–∫—Å (–ü–†–ò–ú–ï–ù–Å–ù):**
1. ‚úÖ –°–æ–∑–¥–∞–Ω API `/api/upsert-user.js` (service role key –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
2. ‚úÖ AuthProvider –≤—ã–∑—ã–≤–∞–µ—Ç API –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ Supabase
3. ‚úÖ **PricingPage —Ç–æ–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç API** (–¥–ª—è –Ω–µ-–∞–¥–º–∏–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–∞—Ä–∏—Ñ–æ–≤)
4. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Vercel

### ‚úÖ –°–¥–µ–ª–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è
- **–£–¥–∞–ª–µ–Ω–∏–µ —é–∑–µ—Ä–æ–≤ –≤ UsersTab:**
  - –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞
  - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —á–µ–∫–±–æ–∫—Å—ã
  - –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- **–£–±—Ä–∞–Ω LVL —Å—Ç–æ–ª–±–µ—Ü** ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **–£–±—Ä–∞–Ω–æ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥-–º–æ–¥–∞–ª–∫–∞** ‚Äî –∏–∑ App.tsx
- **PricingPage —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —é–∑–µ—Ä–æ–≤** ‚Äî fetch –∫ /api/upsert-user

---

### ‚úÖ Done (–°–µ–≥–æ–¥–Ω—è)
- **App CRM (UsersTab) - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω**:
  - –¢–∞–±–ª–∏—Ü–∞ –∏–≥—Ä–æ–∫–æ–≤: –∞–≤–∞—Ç–∞—Ä, –∏–º—è, —É—Ä–æ–≤–µ–Ω—å (–±–µ–π–¥–∂), AR, BUL, –±–∏–ª–µ—Ç—ã, –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç
  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª–∏–∫–∞–º –Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ (level, AR, BUL, last_seen)
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 20 –∑–∞–ø–∏—Å–µ–π
  - –ü–æ–∏—Å–∫ –ø–æ telegram_id, username, –∏–º–µ–Ω–∏
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∏–≥—Ä–æ–∫–æ–≤, —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å, –≤—Å–µ–≥–æ AR, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 24—á

- **–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω)**:
  - –®–∞–ø–∫–∞: –∞–≤–∞—Ç–∞—Ä, –∏–º—è, username, telegram_id, —É—Ä–æ–≤–µ–Ω—å, –¥–∞—Ç—ã
  - –ë–∞–ª–∞–Ω—Å—ã AR/BUL —Å –∫–Ω–æ–ø–∫–∞–º–∏ ¬±
  - –ë–∏–ª–µ—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–±–∞–≤–∏—Ç—å"
  - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20)
  - –°–∫–∏–Ω—ã (–∫—É–ø–ª–µ–Ω–Ω—ã–µ, –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–º–µ—á–µ–Ω)
  - –§–µ—Ä–º–∞ (–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ —É—Ä–æ–≤–Ω–∏)
  - –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram"

- **–ê–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
  - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ AR/BUL (–º–æ–¥–∞–ª–∫–∞)
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à (–≤—ã–±–æ—Ä –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### üèóÔ∏è –†–∞–Ω–µ–µ —Å–¥–µ–ª–∞–Ω–æ
- **FinalBattle –±–∞–≥–∏**: truncate –Ω–∏–∫–∏, —Ä—É—Å—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∑–∞—â–∏—Ç–∞ –æ—Ç loop
- **BackButton –∫–æ–Ω—Ñ–ª–∏–∫—Ç**: SELF_MANAGED_PAGES fix
- **–ü–æ–ª—É—Ñ–∏–Ω–∞–ª "–°–í–ï–¢–û–§–û–†"**: –∑–≤—É–∫–∏, offset —Ä—É–ª–µ—Ç–∫–∏, Array(50), –ø—Ä–∏–∑—ã
- **Dev Test Panel** (`/live-test`): 4 –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Live Arena Components**: Tour1Drum, Tour2Squeeze, SemifinalTraffic, FinalBattle
- **SFX & Haptics**: useArenaSounds (Web Audio), useArenaHaptics (TMA)

### ‚è≥ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- –û—Ç–∫—Ä–æ–π https://ararena.pro –≤ Telegram
- –ó–∞–π–¥–∏ –≤ Admin Panel ‚Üí –Æ–∑–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä—å:
  - [ ] –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏
  - [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–ª–∏–∫ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É)
  - [ ] –ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Üí –ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞
  - [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ AR/BUL —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ —Å–ø–∏—Å–∫—É
