# Current State

## üöÄ Active Task
**–§–∏–∫—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Mini App**

### üîç –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –ü–æ—á–µ–º—É —Ç–æ–ª—å–∫–æ 17 —é–∑–µ—Ä–æ–≤?

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑—ã:**
- `users` (Mini App): **17** –∑–∞–ø–∏—Å–µ–π
- `bot_users` (–±–æ—Ç): **1527** –∑–∞–ø–∏—Å–µ–π
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è: ~1.1%** ‚Äî —ç—Ç–æ –†–ï–ê–õ–¨–ù–´–ï –¥–∞–Ω–Ω—ã–µ

**–ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∞ `Users can update own profile` —Ç—Ä–µ–±—É–µ—Ç `auth.uid() = id`
- –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Telegram Auth, –Ω–µ Supabase Auth ‚Üí `auth.uid()` = NULL
- INSERT —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–µ—Ä–≤–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ), –Ω–æ UPDATE –ø–∞–¥–∞–µ—Ç (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤–∏–∑–∏—Ç—ã)
- `last_seen_at` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –¥–ª—è –≤–µ—Ä–Ω—É–≤—à–∏—Ö—Å—è —é–∑–µ—Ä–æ–≤

**–§–∏–∫—Å (–ü–†–ò–ú–ï–ù–Å–ù):**
1. ‚úÖ –°–æ–∑–¥–∞–Ω API `/api/upsert-user.js` (service role key –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
2. ‚úÖ AuthProvider –≤—ã–∑—ã–≤–∞–µ—Ç API –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ Supabase
3. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Vercel

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –≤—Å–µ —é–∑–µ—Ä—ã –±—É–¥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ `last_seen_at` –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è.

---

### ‚úÖ Done (–°–µ–≥–æ–¥–Ω—è)
- **App CRM (UsersTab) - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω**:
  - –¢–∞–±–ª–∏—Ü–∞ –∏–≥—Ä–æ–∫–æ–≤: –∞–≤–∞—Ç–∞—Ä, –∏–º—è, —É—Ä–æ–≤–µ–Ω—å (–±–µ–π–¥–∂), AR, BUL, –±–∏–ª–µ—Ç—ã, –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç
  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª–∏–∫–∞–º –Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ (level, AR, BUL, last_seen)
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 20 –∑–∞–ø–∏—Å–µ–π
  - –ü–æ–∏—Å–∫ –ø–æ telegram_id, username, –∏–º–µ–Ω–∏
  - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –∏–≥—Ä–æ–∫–æ–≤, —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å, –≤—Å–µ–≥–æ AR, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ 24—á

- **–ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω)**:
  - –®–∞–ø–∫–∞: –∞–≤–∞—Ç–∞—Ä, –∏–º—è, username, telegram_id, —É—Ä–æ–≤–µ–Ω—å, –¥–∞—Ç—ã
  - –ë–∞–ª–∞–Ω—Å—ã AR/BUL —Å –∫–Ω–æ–ø–∫–∞–º–∏ ¬±
  - –ë–∏–ª–µ—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–±–∞–≤–∏—Ç—å"
  - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20)
  - –°–∫–∏–Ω—ã (–∫—É–ø–ª–µ–Ω–Ω—ã–µ, –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–º–µ—á–µ–Ω)
  - –§–µ—Ä–º–∞ (–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ —É—Ä–æ–≤–Ω–∏)
  - –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∏—Å–∞—Ç—å –≤ Telegram"

- **–ê–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
  - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ AR/BUL (–º–æ–¥–∞–ª–∫–∞)
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à (–≤—ã–±–æ—Ä –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö)
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### üèóÔ∏è –†–∞–Ω–µ–µ —Å–¥–µ–ª–∞–Ω–æ
- **FinalBattle –±–∞–≥–∏**: truncate –Ω–∏–∫–∏, —Ä—É—Å—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∑–∞—â–∏—Ç–∞ –æ—Ç loop
- **BackButton –∫–æ–Ω—Ñ–ª–∏–∫—Ç**: SELF_MANAGED_PAGES fix
- **–ü–æ–ª—É—Ñ–∏–Ω–∞–ª "–°–í–ï–¢–û–§–û–†"**: –∑–≤—É–∫–∏, offset —Ä—É–ª–µ—Ç–∫–∏, Array(50), –ø—Ä–∏–∑—ã
- **Dev Test Panel** (`/live-test`): 4 –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Live Arena Components**: Tour1Drum, Tour2Squeeze, SemifinalTraffic, FinalBattle
- **SFX & Haptics**: useArenaSounds (Web Audio), useArenaHaptics (TMA)

### ‚è≥ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- –û—Ç–∫—Ä–æ–π https://ararena.pro –≤ Telegram
- –ó–∞–π–¥–∏ –≤ Admin Panel ‚Üí –Æ–∑–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä—å:
  - [ ] –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏
  - [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–ª–∏–∫ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É)
  - [ ] –ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ ‚Üí –ø—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞
  - [ ] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ AR/BUL —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ —Å–ø–∏—Å–∫—É
