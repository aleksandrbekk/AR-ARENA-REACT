# üí∞ ECONOMY SPECIFICATION

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 12.12.2025
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ

---

## üìñ –ö–û–ù–¶–ï–ü–¶–ò–Ø

AR ARENA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤—É—Ö–≤–∞–ª—é—Ç–Ω—É—é —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫—É—é –º–æ–¥–µ–ª—å**:
- **AR** ‚Äî –ø—Ä–µ–º–∏—É–º –≤–∞–ª—é—Ç–∞ (–ø–æ–∫—É–ø–∫–∞ –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏)
- **BUL** ‚Äî –∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ (—Ñ–µ—Ä–º–∞, —Ç–∞–ø—ã, –∑–∞–¥–∞–Ω–∏—è)

---

## üíé AR (–ü–†–ï–ú–ò–£–ú –í–ê–õ–Æ–¢–ê)

### –ü–æ–ª—É—á–µ–Ω–∏–µ
| –°–ø–æ—Å–æ–± | –û–ø–∏—Å–∞–Ω–∏–µ | –ö—É—Ä—Å |
|--------|----------|------|
| **–ü–æ–∫—É–ø–∫–∞ (Lava.top)** | –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π/–∫—Ä–∏–ø—Ç–æ–π | ~1 USD = 10 AR (—É—Ç–æ—á–Ω–∏—Ç—å) |
| **–ü–æ–±–µ–¥–∞ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ** | –î–∂–µ–∫–ø–æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏ | ‚Äî |
| **–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç –∞–¥–º–∏–Ω–∞** | –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ (–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏) | ‚Äî |

### –¢—Ä–∞—Ç—ã
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|-----------|------------|
| **–ë–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∏** | 10-50 AR –∑–∞ –±–∏–ª–µ—Ç | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–æ–∑—ã–≥—Ä—ã—à–∞ |
| ~~**–ü—Ä–µ–º–∏—É–º —Å–∫–∏–Ω—ã**~~ | ‚ùå –ù–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | –í—Å–µ —Å–∫–∏–Ω—ã –ø–æ–∫—É–ø–∞—é—Ç—Å—è –∑–∞ BUL |
| ~~**–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ñ–µ—Ä–º—ã**~~ | ‚ùå –ù–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è | –ë–µ–∑ pay-to-win –º–µ—Ö–∞–Ω–∏–∫ |

### –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
users
‚îú‚îÄ‚îÄ balance_ar (DECIMAL) -- —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å AR
‚îî‚îÄ‚îÄ total_ar_spent (DECIMAL) -- —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
```

### –ö—É—Ä—Å AR ‚Üí USD (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
| –ü–∞–∫–µ—Ç | USD | AR | –ë–æ–Ω—É—Å |
|-------|-----|-----|-------|
| –°—Ç–∞—Ä—Ç–æ–≤—ã–π | $2.99 | 30 AR | ‚Äî |
| –ü–æ–ø—É–ª—è—Ä–Ω—ã–π | $4.99 | 50 AR | ‚Äî |
| –í—ã–≥–æ–¥–Ω—ã–π | $9.99 | 110 AR | +10% |
| –ú–∞–∫—Å–∏ | $19.99 | 230 AR | +15% |
| –ú–µ–≥–∞ | $49.99 | 600 AR | +20% |

**‚ö†Ô∏è –ö—É—Ä—Å—ã –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —É –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞!**

---

## üêÇ BUL (–ò–ì–†–û–í–ê–Ø –í–ê–õ–Æ–¢–ê)

### –ü–æ–ª—É—á–µ–Ω–∏–µ
| –°–ø–æ—Å–æ–± | –û–ø–∏—Å–∞–Ω–∏–µ | –î–æ—Ö–æ–¥ |
|--------|----------|-------|
| **–¢–∞–ø—ã** | –ö–ª–∏–∫ –ø–æ –±—ã–∫—É | `base_tap_value √ó skin_multiplier` |
| **–§–µ—Ä–º–∞** | –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ | `income_per_hour` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–æ–∫–∞—Ü–∏–π + –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è) |
| **–ó–∞–¥–∞–Ω–∏—è** | –†–∞–∑–æ–≤—ã–µ –Ω–∞–≥—Ä–∞–¥—ã | 100-10000 BUL (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–¥–∞–Ω–∏—è) |
| **–†–µ—Ñ–µ—Ä–∞–ª—ã** | –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π | 500 BUL –∑–∞ –¥—Ä—É–≥–∞ + 10% –æ—Ç –µ–≥–æ –¥–æ—Ö–æ–¥–æ–≤ (?) |
| **–ü—Ä–æ–º–æ-–∞–∫—Ü–∏–∏** | –ü–æ–¥–∞—Ä–∫–∏ –æ—Ç –∞–¥–º–∏–Ω–∞ | –í—Ä—É—á–Ω—É—é |

### –¢—Ä–∞—Ç—ã
| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–æ–∏–º–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|-----------|------------|
| **–°–∫–∏–Ω—ã** | 1000-100000 BUL | –†–∞–∑–Ω—ã–µ —Ä–µ–¥–∫–æ—Å—Ç–∏ |
| **–õ–æ–∫–∞—Ü–∏–∏ —Ñ–µ—Ä–º—ã** | 5000-500000 BUL | –†–∞–∑–Ω—ã–µ –¥–æ—Ö–æ–¥—ã |
| **–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Ñ–µ—Ä–º—ã** | 1000-50000 BUL | –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –ª–æ–∫–∞—Ü–∏–∏ |
| ~~**–ë–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∏**~~ | ‚ùå –¢–æ–ª—å–∫–æ AR | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç |

### –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
users
‚îú‚îÄ‚îÄ balance_bul (DECIMAL) -- —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å BUL
‚îú‚îÄ‚îÄ total_bul_earned (DECIMAL) -- —Å–∫–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ
‚îî‚îÄ‚îÄ total_bul_spent (DECIMAL) -- —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ
```

---

## üëÜ –¢–ê–ü–´ (TAP SYSTEM)

### –ë–∞–∑–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- –ö–ª–∏–∫ –ø–æ –±—ã–∫—É ‚Üí +1 BUL (–±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
- –° –ø—Ä–æ–∫–∞—á–∫–æ–π/—Å–∫–∏–Ω–∞–º–∏: +2, +5, +10 BUL –∑–∞ –∫–ª–∏–∫

### –§–æ—Ä–º—É–ª–∞ –¥–æ—Ö–æ–¥–∞
```
tap_income = base_tap_value √ó skin_multiplier
```

**–ü—Ä–∏–º–µ—Ä:**
- `base_tap_value = 1 BUL`
- –°–∫–∏–Ω "–ó–æ–ª–æ—Ç–æ–π –±—ã–∫": `multiplier = 2x`
- –î–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫: `1 √ó 2 = 2 BUL`

### –õ–∏–º–∏—Ç—ã
- ‚ùå **–ù–ï–¢ –ª–∏–º–∏—Ç–∞ –∫–ª–∏–∫–æ–≤** (–º–æ–∂–Ω–æ —Ç–∞–ø–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ)
- ‚ùå **–ù–ï–¢ —ç–Ω–µ—Ä–≥–∏–∏** (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- ‚úÖ **–ï–°–¢–¨ –∑–∞—â–∏—Ç–∞ –æ—Ç –±–æ—Ç–æ–≤** (–∫–ª–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞ –±—ã–∫–∞)

### –°–∫–∏–Ω—ã
–ö–∞–∂–¥—ã–π —Å–∫–∏–Ω –∏–º–µ–µ—Ç `multiplier`:
| –†–µ–¥–∫–æ—Å—Ç—å | –ü—Ä–∏–º–µ—Ä | Multiplier | –¶–µ–Ω–∞ BUL |
|----------|--------|-----------|----------|
| Common | –û–±—ã—á–Ω—ã–π –±—ã–∫ | 1x | 0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) |
| Uncommon | –ó–µ–ª—ë–Ω—ã–π –±—ã–∫ | 1.2x | 5000 |
| Rare | –°–∏–Ω–∏–π –±—ã–∫ | 1.5x | 15000 |
| Epic | –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –±—ã–∫ | 2x | 50000 |
| Legendary | –ó–æ–ª–æ—Ç–æ–π –±—ã–∫ | 3x | 200000 |

**‚ö†Ô∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å!**

---

## üåæ –§–ï–†–ú–ê (FARM SYSTEM)

### –ë–∞–∑–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ BUL –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –î–æ—Ö–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö **–ª–æ–∫–∞—Ü–∏–π** –∏ **–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ: `income_per_hour √ó max_accumulation_hours`

### –§–æ—Ä–º—É–ª–∞ –¥–æ—Ö–æ–¥–∞
```
income_per_hour = SUM(location_income + equipment_bonus)
```

**–ü—Ä–∏–º–µ—Ä:**
- –õ–æ–∫–∞—Ü–∏—è "–®–∞—Ö—Ç–∞": 100 BUL/—á–∞—Å
- –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ "–î—Ä–µ–ª—å": +20 BUL/—á–∞—Å
- –õ–æ–∫–∞—Ü–∏—è "–ó–∞–≤–æ–¥": 200 BUL/—á–∞—Å
- **–ò—Ç–æ–≥–æ:** `100 + 20 + 200 = 320 BUL/—á–∞—Å`

### –õ–æ–∫–∞—Ü–∏–∏
| –õ–æ–∫–∞—Ü–∏—è | –î–æ—Ö–æ–¥ (BUL/—á–∞—Å) | –¶–µ–Ω–∞ (BUL) | –ú–∞–∫—Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ |
|---------|----------------|-----------|-----------------|
| –®–∞—Ö—Ç–∞ | 100 | 5000 | 12 —á–∞—Å–æ–≤ |
| –ó–∞–≤–æ–¥ | 200 | 25000 | 12 —á–∞—Å–æ–≤ |
| –§–µ—Ä–º–∞ | 300 | 75000 | 12 —á–∞—Å–æ–≤ |
| –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è | 500 | 200000 | 12 —á–∞—Å–æ–≤ |

**‚ö†Ô∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å!**

### –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
| –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ | –¢–∏–ø | –ë–æ–Ω—É—Å | –¶–µ–Ω–∞ (BUL) | –¢—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞—Ü–∏—é |
|--------------|-----|-------|-----------|-----------------|
| –î—Ä–µ–ª—å | –®–∞—Ö—Ç–∞ | +20 BUL/—á–∞—Å | 2000 | –®–∞—Ö—Ç–∞ |
| –ö–æ–Ω–≤–µ–π–µ—Ä | –ó–∞–≤–æ–¥ | +50 BUL/—á–∞—Å | 10000 | –ó–∞–≤–æ–¥ |
| –¢—Ä–∞–∫—Ç–æ—Ä | –§–µ—Ä–º–∞ | +80 BUL/—á–∞—Å | 30000 | –§–µ—Ä–º–∞ |
| –†–µ–∞–∫—Ç–æ—Ä | –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è | +150 BUL/—á–∞—Å | 80000 | –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è |

**‚ö†Ô∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å!**

### –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–µ –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- BUL –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ú–∞–∫—Å–∏–º—É–º:** `income_per_hour √ó 12 —á–∞—Å–æ–≤` (–Ω–∞–ø—Ä–∏–º–µ—Ä)
- –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º—É–º–∞ ‚Äî –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- –ù—É–∂–Ω–æ –∑–∞–π—Ç–∏ –∏ –Ω–∞–∂–∞—Ç—å "–°–æ–±—Ä–∞—Ç—å"

**–ü—Ä–∏–º–µ—Ä:**
- –î–æ—Ö–æ–¥: 300 BUL/—á–∞—Å
- –ú–∞–∫—Å–∏–º—É–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è: 12 —á–∞—Å–æ–≤
- –ù–µ –∑–∞—Ö–æ–¥–∏–ª 15 —á–∞—Å–æ–≤ ‚Üí –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å `300 √ó 12 = 3600 BUL` (–Ω–µ 4500!)

---

## üéØ –ó–ê–î–ê–ù–ò–Ø (TASKS SYSTEM)

### –¢–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π
| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ù–∞–≥—Ä–∞–¥–∞ BUL | –ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å |
|-----|----------|------------|---------------|
| **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª** | –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram –∫–∞–Ω–∞–ª | 500-1000 | –†–∞–∑–æ–≤–æ |
| **–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π** | –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å N –¥—Ä—É–∑–µ–π | 500 –∑–∞ –¥—Ä—É–≥–∞ | –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ |
| **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å** | –ó–∞—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å | 100-500 | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ |
| **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** | –°–æ–±—Ä–∞—Ç—å X BUL, –∫—É–ø–∏—Ç—å Y —Å–∫–∏–Ω–æ–≤ | 1000-10000 | –†–∞–∑–æ–≤–æ |
| **–°–æ—Ü. —Å–µ—Ç–∏** | –†–µ–ø–æ—Å—Ç/–ª–∞–π–∫ –≤ —Å–æ—Ü. —Å–µ—Ç—è—Ö | 200-500 | –†–∞–∑–æ–≤–æ |

**‚ö†Ô∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å!**

### –¢–∞–±–ª–∏—Ü–∞ `tasks`
```sql
tasks
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ title (VARCHAR) -- "–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª"
‚îú‚îÄ‚îÄ description (TEXT) -- "–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –Ω–∞—à Telegram –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—É—á–∏ 500 BUL"
‚îú‚îÄ‚îÄ reward_bul (INT) -- 500
‚îú‚îÄ‚îÄ task_type (VARCHAR) -- 'subscribe' | 'invite' | 'daily' | 'achievement' | 'social'
‚îú‚îÄ‚îÄ task_data (JSON) -- { "url": "https://t.me/ar_arena", "required_count": 1 }
‚îú‚îÄ‚îÄ is_repeatable (BOOLEAN) -- false
‚îú‚îÄ‚îÄ is_active (BOOLEAN) -- true
‚îî‚îÄ‚îÄ created_at (TIMESTAMPTZ)
```

### –¢–∞–±–ª–∏—Ü–∞ `user_tasks`
```sql
user_tasks
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ user_id (FK ‚Üí users)
‚îú‚îÄ‚îÄ task_id (FK ‚Üí tasks)
‚îú‚îÄ‚îÄ completed_at (TIMESTAMPTZ)
‚îî‚îÄ‚îÄ UNIQUE(user_id, task_id) -- (–µ—Å–ª–∏ task –Ω–µ repeatable)
```

### RPC —Ñ—É–Ω–∫—Ü–∏—è: `complete_task()`
```sql
CREATE OR REPLACE FUNCTION complete_task(p_telegram_id BIGINT, p_task_id INT)
RETURNS JSON AS $$
DECLARE
  v_user_id INT;
  v_reward INT;
  v_new_balance DECIMAL;
BEGIN
  -- –ü–æ–ª—É—á–∏—Ç—å user_id
  SELECT id INTO v_user_id FROM users WHERE telegram_id = p_telegram_id;

  -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
  IF EXISTS (SELECT 1 FROM user_tasks WHERE user_id = v_user_id AND task_id = p_task_id) THEN
    RETURN json_build_object('success', false, 'error', 'Task already completed');
  END IF;

  -- –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É
  SELECT reward_bul INTO v_reward FROM tasks WHERE id = p_task_id AND is_active = true;

  IF v_reward IS NULL THEN
    RETURN json_build_object('success', false, 'error', 'Task not found or inactive');
  END IF;

  -- –ù–∞—á–∏—Å–ª–∏—Ç—å BUL
  UPDATE users SET balance_bul = balance_bul + v_reward, total_bul_earned = total_bul_earned + v_reward
  WHERE id = v_user_id
  RETURNING balance_bul INTO v_new_balance;

  -- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  INSERT INTO user_tasks (user_id, task_id, completed_at) VALUES (v_user_id, p_task_id, NOW());

  RETURN json_build_object('success', true, 'reward', v_reward, 'new_balance', v_new_balance);
END;
$$ LANGUAGE plpgsql;
```

---

## üë• –†–ï–§–ï–†–ê–õ–´ (REFERRAL SYSTEM)

### –ë–∞–∑–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: % –æ—Ç –¥–æ—Ö–æ–¥–æ–≤ –¥—Ä—É–≥–∞

### –ù–∞–≥—Ä–∞–¥—ã
| –°–æ–±—ã—Ç–∏–µ | –ù–∞–≥—Ä–∞–¥–∞ A | –ù–∞–≥—Ä–∞–¥–∞ B |
|---------|-----------|-----------|
| B –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è | 500 BUL | 200 BUL (—Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å) |
| B –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∫—É–ø–∏–ª AR | 1000 BUL (?) | ‚Äî |
| ~~B –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç BUL~~ | ~~10% –æ—Ç –¥–æ—Ö–æ–¥–∞ B~~ | ‚ùå –ù–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è (–º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ñ–∞—Ä–º—É) |

**‚ö†Ô∏è –ù—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∫—É —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤!**

### –¢–∞–±–ª–∏—Ü–∞ `referrals`
```sql
referrals
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ referrer_id (FK ‚Üí users) -- –∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
‚îú‚îÄ‚îÄ referred_id (FK ‚Üí users) -- –∫–æ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏
‚îú‚îÄ‚îÄ created_at (TIMESTAMPTZ)
‚îî‚îÄ‚îÄ UNIQUE(referred_id) -- –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω —Ä–µ—Ñ–µ—Ä–µ—Ä
```

### RPC —Ñ—É–Ω–∫—Ü–∏—è: `register_with_referral()`
```sql
CREATE OR REPLACE FUNCTION register_with_referral(
  p_telegram_id BIGINT,
  p_referrer_telegram_id BIGINT
)
RETURNS JSON AS $$
DECLARE
  v_user_id INT;
  v_referrer_id INT;
BEGIN
  -- –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  INSERT INTO users (telegram_id, balance_bul, balance_ar)
  VALUES (p_telegram_id, 200, 0) -- —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å 200 BUL
  RETURNING id INTO v_user_id;

  -- –ù–∞–π—Ç–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
  SELECT id INTO v_referrer_id FROM users WHERE telegram_id = p_referrer_telegram_id;

  IF v_referrer_id IS NOT NULL THEN
    -- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≤—è–∑—å
    INSERT INTO referrals (referrer_id, referred_id) VALUES (v_referrer_id, v_user_id);

    -- –ù–∞–≥—Ä–∞–¥–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
    UPDATE users SET balance_bul = balance_bul + 500, total_bul_earned = total_bul_earned + 500
    WHERE id = v_referrer_id;

    RETURN json_build_object('success', true, 'referral_bonus', 500);
  END IF;

  RETURN json_build_object('success', true, 'referral_bonus', 0);
END;
$$ LANGUAGE plpgsql;
```

---

## üí∏ –ë–ê–õ–ê–ù–° –ò –¢–†–ê–ù–ó–ê–ö–¶–ò–ò

### –¢–∞–±–ª–∏—Ü–∞ `users` (–±–∞–ª–∞–Ω—Å)
```sql
users
‚îú‚îÄ‚îÄ balance_ar (DECIMAL DEFAULT 0) -- —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å AR
‚îú‚îÄ‚îÄ balance_bul (DECIMAL DEFAULT 0) -- —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å BUL
‚îú‚îÄ‚îÄ total_ar_spent (DECIMAL DEFAULT 0) -- –≤—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ AR (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
‚îú‚îÄ‚îÄ total_bul_earned (DECIMAL DEFAULT 0) -- –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ BUL (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
‚îî‚îÄ‚îÄ total_bul_spent (DECIMAL DEFAULT 0) -- –≤—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ BUL (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
```

### –¢–∞–±–ª–∏—Ü–∞ `transactions` (–∏—Å—Ç–æ—Ä–∏—è)
```sql
transactions
‚îú‚îÄ‚îÄ id (PK)
‚îú‚îÄ‚îÄ user_id (FK ‚Üí users)
‚îú‚îÄ‚îÄ currency (VARCHAR) -- 'AR' | 'BUL'
‚îú‚îÄ‚îÄ amount (DECIMAL) -- –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º (—Ç—Ä–∞—Ç–∞)
‚îú‚îÄ‚îÄ type (VARCHAR) -- 'purchase' | 'reward' | 'farm' | 'task' | 'referral' | 'giveaway' | 'spend'
‚îú‚îÄ‚îÄ description (TEXT) -- "Bought 50 AR via Lava.top"
‚îú‚îÄ‚îÄ metadata (JSON) -- { "payment_id": "...", "task_id": 123, ... }
‚îî‚îÄ‚îÄ created_at (TIMESTAMPTZ)
```

### RPC —Ñ—É–Ω–∫—Ü–∏—è: `log_transaction()`
```sql
CREATE OR REPLACE FUNCTION log_transaction(
  p_user_id INT,
  p_currency VARCHAR,
  p_amount DECIMAL,
  p_type VARCHAR,
  p_description TEXT,
  p_metadata JSON DEFAULT '{}'
)
RETURNS VOID AS $$
BEGIN
  INSERT INTO transactions (user_id, currency, amount, type, description, metadata)
  VALUES (p_user_id, p_currency, p_amount, p_type, p_description, p_metadata);
END;
$$ LANGUAGE plpgsql;
```

---

## üìä –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –ë–ê–õ–ê–ù–°–´

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ AR –≤ —Å–∏—Å—Ç–µ–º–µ
1. –ü–æ–∫—É–ø–∫–∞ –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ (Lava.top)
2. –ü–æ–¥–∞—Ä–∫–∏ –æ—Ç –∞–¥–º–∏–Ω–∞

### –°—Ç–æ–∫–∏ AR –∏–∑ —Å–∏—Å—Ç–µ–º—ã
1. –ë–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ (80% ‚Üí –¥–∂–µ–∫–ø–æ—Ç, 20% ‚Üí –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
2. –î–∂–µ–∫–ø–æ—Ç –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º—É)

**‚ö†Ô∏è –ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (20% –æ—Ç –±–∏–ª–µ—Ç–æ–≤) –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤.**

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ BUL –≤ —Å–∏—Å—Ç–µ–º–µ
1. –¢–∞–ø—ã (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –≤–æ–∑–¥—É—Ö–∞)
2. –§–µ—Ä–º–∞ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –≤–æ–∑–¥—É—Ö–∞)
3. –ó–∞–¥–∞–Ω–∏—è (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –≤–æ–∑–¥—É—Ö–∞)
4. –†–µ—Ñ–µ—Ä–∞–ª—ã (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –≤–æ–∑–¥—É—Ö–∞)

### –°—Ç–æ–∫–∏ BUL –∏–∑ —Å–∏—Å—Ç–µ–º—ã
1. –ü–æ–∫—É–ø–∫–∞ —Å–∫–∏–Ω–æ–≤ (BUL —Å–≥–æ—Ä–∞–µ—Ç)
2. –ü–æ–∫—É–ø–∫–∞ –ª–æ–∫–∞—Ü–∏–π —Ñ–µ—Ä–º—ã (BUL —Å–≥–æ—Ä–∞–µ—Ç)
3. –ü–æ–∫—É–ø–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Ñ–µ—Ä–º—ã (BUL —Å–≥–æ—Ä–∞–µ—Ç)

**‚ö†Ô∏è BUL ‚Äî –∏–Ω—Ñ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –≤–∞–ª—é—Ç–∞! –ù—É–∂–Ω–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Å—Ç–æ–∫–∏.**

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–∞–ª–∞–Ω—Å—É
- **AR:** —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞, –∫—É—Ä—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- **BUL:** –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–Ω—Ñ–ª—è—Ü–∏–µ–π
  - –ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è > —Å—Ç–æ–∫–∏ ‚Üí —Ü–µ–Ω—ã –Ω–∞ —Å–∫–∏–Ω—ã/–ª–æ–∫–∞—Ü–∏–∏ —Ä–∞—Å—Ç—É—Ç
  - –ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è < —Å—Ç–æ–∫–∏ ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–±–æ–ª—å—à–µ –∑–∞–¥–∞–Ω–∏–π)

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **Total AR in system** | –°—É–º–º–∞ –≤—Å–µ—Ö `balance_ar` |
| **Total AR purchased** | –°—É–º–º–∞ –≤—Å–µ—Ö –ø–æ–∫—É–ø–æ–∫ —á–µ—Ä–µ–∑ Lava.top |
| **Total AR spent** | –°—É–º–º–∞ –≤—Å–µ—Ö `total_ar_spent` |
| **Total BUL in system** | –°—É–º–º–∞ –≤—Å–µ—Ö `balance_bul` |
| **Total BUL generated** | –°—É–º–º–∞ –≤—Å–µ—Ö `total_bul_earned` |
| **Total BUL spent** | –°—É–º–º–∞ –≤—Å–µ—Ö `total_bul_spent` |
| **Average AR per user** | `Total AR / Users count` |
| **Average BUL per user** | `Total BUL / Users count` |

### –ì—Ä–∞—Ñ–∏–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è BUL –ø–æ –¥–Ω—è–º (—Ç–∞–ø—ã, —Ñ–µ—Ä–º–∞, –∑–∞–¥–∞–Ω–∏—è)
- –¢—Ä–∞—Ç—ã BUL –ø–æ –¥–Ω—è–º (—Å–∫–∏–Ω—ã, –ª–æ–∫–∞—Ü–∏–∏)
- –ü–æ–∫—É–ø–∫–∏ AR –ø–æ –¥–Ω—è–º
- –¢—Ä–∞—Ç—ã AR –ø–æ –¥–Ω—è–º (–±–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∏)

---

## üéØ –ò–¢–û–ì–û

| –í–∞–ª—é—Ç–∞ | –ü–æ–ª—É—á–µ–Ω–∏–µ | –¢—Ä–∞—Ç—ã | –¢–∏–ø |
|--------|-----------|-------|-----|
| **AR** | –ü–æ–∫—É–ø–∫–∞ (Lava.top), –†–æ–∑—ã–≥—Ä—ã—à–∏ | –ë–∏–ª–µ—Ç—ã –Ω–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ | –ü—Ä–µ–º–∏—É–º, —Å—Ç–∞–±–∏–ª—å–Ω–∞—è |
| **BUL** | –¢–∞–ø—ã, –§–µ—Ä–º–∞, –ó–∞–¥–∞–Ω–∏—è, –†–µ—Ñ–µ—Ä–∞–ª—ã | –°–∫–∏–Ω—ã, –õ–æ–∫–∞—Ü–∏–∏, –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ | –ò–≥—Ä–æ–≤–∞—è, –∏–Ω—Ñ–ª—è—Ü–∏–æ–Ω–Ω–∞—è |

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:** AR –∏ BUL –ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞!

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä (‚ö†Ô∏è –ù–£–ñ–ù–û –£–¢–û–ß–ù–ò–¢–¨ –ö–£–†–°–´ –ò –¶–ï–ù–´!)
**–î–∞—Ç–∞:** 12.12.2025
