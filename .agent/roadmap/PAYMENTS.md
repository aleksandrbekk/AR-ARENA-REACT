# üí≥ PAYMENTS ROADMAP

## –°—Ç–∞—Ç—É—Å: üü° –í —Ä–∞–±–æ—Ç–µ (70%)

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 12.12.2025

---

## üìä –û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–°

```
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  70%
```

- ‚úÖ –ì–æ—Ç–æ–≤–æ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Lava.top, –ø–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- üêõ –ü—Ä–æ–±–ª–µ–º—ã: –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: –†–µ—à–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç, webhook –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## üéØ –ö–û–ù–¶–ï–ü–¶–ò–Ø

**–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** ‚Äî –ø–æ–∫—É–ø–∫–∞ –ø—Ä–µ–º–∏—É–º –≤–∞–ª—é—Ç—ã **AR** –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏ (USD/RUB/EUR).

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä: Lava.top
- API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Ä—Ç, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
- Webhook –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞

### –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–∞–∫–µ—Ç AR (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100 AR –∑–∞ $5)
2. –ö–ª–∏–∫ "–ö—É–ø–∏—Ç—å" ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—á—ë—Ç –≤ Lava.top
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã Lava
4. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –∏ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
5. ‚ö†Ô∏è **–ü–†–û–ë–õ–ï–ú–ê:** –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
6. Webhook –æ—Ç Lava ‚Üí –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ AR –Ω–∞ –±–∞–ª–∞–Ω—Å

---

## ‚úÖ –ì–û–¢–û–í–û

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Lava.top
- [x] **API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**
  - API endpoint: `https://api.lava.top/...`
  - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook

- [x] **–°–æ–∑–¥–∞–Ω–∏–µ —Å—á—ë—Ç–∞**
  - RPC —Ñ—É–Ω–∫—Ü–∏—è: `create_lava_payment(telegram_id, amount_usd, ar_amount)`
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ order_id
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É `payments`
  - –í–æ–∑–≤—Ä–∞—Ç URL –¥–ª—è –æ–ø–ª–∞—Ç—ã

- [x] **–ü–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç**
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–ø–ª–∞—Ç–∏—Ç—å
  - –î–µ–Ω—å–≥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç Lava
  - Webhook –ø–æ–ª—É—á–µ–Ω

### UI
- [x] **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫—É–ø–∫–∏ AR** (–ø—É—Ç—å: `/buy-ar` –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–π)
  - –°–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ AR (–Ω–∞–ø—Ä–∏–º–µ—Ä: 50 AR, 100 AR, 500 AR, 1000 AR)
  - –¶–µ–Ω—ã –≤ USD
  - –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Lava

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [x] **–¢–∞–±–ª–∏—Ü–∞ payments**
  ```sql
  payments
  ‚îú‚îÄ‚îÄ id (PK)
  ‚îú‚îÄ‚îÄ telegram_id (FK ‚Üí users)
  ‚îú‚îÄ‚îÄ order_id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è Lava)
  ‚îú‚îÄ‚îÄ amount_usd
  ‚îú‚îÄ‚îÄ ar_amount
  ‚îú‚îÄ‚îÄ status ('pending' | 'success' | 'failed')
  ‚îú‚îÄ‚îÄ lava_payment_id
  ‚îú‚îÄ‚îÄ created_at
  ‚îî‚îÄ‚îÄ updated_at
  ```

---

## üêõ –ü–†–û–ë–õ–ï–ú–´

### ‚ö†Ô∏è –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç –Ω–∞ —Å–∞–π—Ç–µ Lava.top, –Ω–æ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ Telegram Mini App. –û–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Lava —Å —Ç–µ–∫—Å—Ç–æ–º "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ".

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –æ—Ç Lava:**
> –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è.

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

#### –í–∞—Ä–∏–∞–Ω—Ç A: Deep Link (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```tsx
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á—ë—Ç–∞ –ø–µ—Ä–µ–¥–∞—Ç—å success_url —Å deep link
const successUrl = `https://t.me/ARARENA_BOT/app?payment_success=true&order_id=${orderId}`;

// Lava –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —ç—Ç–æ—Ç URL ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç Mini App
```

**–ü–ª—é—Å—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ Mini App
- –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞!"

**–ú–∏–Ω—É—Å—ã:**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ deep links –≤ Telegram
- –ù—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ iOS/Android

#### –í–∞—Ä–∏–∞–Ω—Ç B: Polling (–∑–∞–ø–∞—Å–Ω–æ–π)
```tsx
// –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ "–ö—É–ø–∏—Ç—å" ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è
// –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API

useEffect(() => {
  const interval = setInterval(async () => {
    const status = await checkPaymentStatus(orderId);
    if (status === 'success') {
      // –ü–æ–∫–∞–∑–∞—Ç—å "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!"
      clearInterval(interval);
    }
  }, 3000);
}, [orderId]);
```

**–ü–ª—é—Å—ã:**
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Lava
- –†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞

**–ú–∏–Ω—É—Å—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ Mini App –≤—Ä—É—á–Ω—É—é
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (polling)

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (best)
1. –ü–µ—Ä–µ–¥–∞—Ç—å `success_url` —Å deep link (–í–∞—Ä–∏–∞–Ω—Ç A)
2. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é "–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞"
3. –í –±–æ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å polling (–í–∞—Ä–∏–∞–Ω—Ç B)

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

---

## ‚è≥ –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–û

### –†–µ—à–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å deep link**
  - –°–æ–∑–¥–∞—Ç—å URL: `https://t.me/ARARENA_BOT/app?payment_success=true&order_id=...`
  - –ü–µ—Ä–µ–¥–∞—Ç—å –≤ `success_url` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á—ë—Ç–∞ Lava
  - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ Mini App –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  - –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞! +X AR"

- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å polling (–∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)**
  - –°–æ–∑–¥–∞—Ç—å RPC: `check_payment_status(order_id)`
  - –í UI –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ "–ö—É–ø–∏—Ç—å" ‚Üí —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è
  - Polling –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
  - –¢–∞–π–º–∞—É—Ç 5 –º–∏–Ω—É—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å "–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π")

- [ ] **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
  - –ï—Å–ª–∏ deep link –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—Å—Ç:
    "–û–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥."
  - –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å" (–≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å polling)

### Webhook –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] **Endpoint –¥–ª—è webhook**
  - –ü—É—Ç—å: `/api/lava-webhook` (–∏–ª–∏ Supabase Edge Function)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Lava (HMAC)
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `payments`
  - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ AR –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram Bot

- [ ] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ webhook –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç–∞–±–ª–∏—Ü—É `webhook_logs`
  - –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

- [ ] **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
  - –ï—Å–ª–∏ webhook –ø—Ä–∏—à—ë–ª, –Ω–æ –ø–ª–∞—Ç—ë–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
  - –ï—Å–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ AR —É–ø–∞–ª–æ ‚Üí –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - Retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)

### –ê–¥–º–∏–Ω–∫–∞
- [ ] **–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π**
  - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π (—Å–º. roadmap/ADMIN.md)
  - –§–∏–ª—å—Ç—Ä—ã (—É—Å–ø–µ—à–Ω—ã–µ, –æ–∂–∏–¥–∞–Ω–∏–µ, –æ—à–∏–±–∫–∞)
  - –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
  - –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ AR (–µ—Å–ª–∏ webhook –Ω–µ –ø—Ä–∏—à—ë–ª)

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π**
  - –û–±—â–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π (USD)
  - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
  - –ö–æ–Ω–≤–µ—Ä—Å–∏—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂)
  - –¢–æ–ø-–ø–ª–∞—Ç–µ–ª—å—â–∏–∫–∏
  - –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –¥–Ω—è–º

---

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –¢–∞–±–ª–∏—Ü–∞ payments
```sql
CREATE TABLE payments (
  id SERIAL PRIMARY KEY,
  telegram_id BIGINT NOT NULL REFERENCES users(telegram_id),
  order_id VARCHAR(255) UNIQUE NOT NULL,
  amount_usd DECIMAL(10, 2) NOT NULL,
  ar_amount INT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending', -- 'pending' | 'success' | 'failed'
  lava_payment_id VARCHAR(255),
  success_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### RPC —Ñ—É–Ω–∫—Ü–∏–∏
```sql
-- –°–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç –≤ Lava
create_lava_payment(p_telegram_id BIGINT, p_amount_usd DECIMAL, p_ar_amount INT)
RETURNS JSON -- { order_id, payment_url }

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
check_payment_status(p_order_id VARCHAR)
RETURNS VARCHAR -- 'pending' | 'success' | 'failed'

-- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å webhook –æ—Ç Lava (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
process_lava_webhook(p_order_id VARCHAR, p_status VARCHAR, p_lava_payment_id VARCHAR)
RETURNS BOOLEAN
```

### Webhook payload (–ø—Ä–∏–º–µ—Ä –æ—Ç Lava)
```json
{
  "order_id": "AR_1234567890",
  "status": "success",
  "amount": 5.00,
  "currency": "USD",
  "payment_id": "lava_abc123",
  "signature": "sha256_hash..."
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
```ts
import crypto from 'crypto';

function verifyLavaSignature(payload: any, signature: string): boolean {
  const secret = process.env.LAVA_SECRET_KEY;
  const hash = crypto
    .createHmac('sha256', secret)
    .update(JSON.stringify(payload))
    .digest('hex');
  return hash === signature;
}
```

---

## üé® –î–ò–ó–ê–ô–ù

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫—É–ø–∫–∏ AR
```tsx
<div className="p-4 pt-16">
  <h1 className="text-2xl font-bold text-white mb-4">–ö—É–ø–∏—Ç—å AR</h1>

  {/* –ü–∞–∫–µ—Ç—ã */}
  <div className="grid grid-cols-2 gap-4">
    <PackageCard
      ar={50}
      price={2.99}
      popular={false}
    />
    <PackageCard
      ar={100}
      price={4.99}
      popular={true}
    />
    <PackageCard
      ar={500}
      price={19.99}
      popular={false}
    />
    <PackageCard
      ar={1000}
      price={34.99}
      popular={false}
    />
  </div>
</div>
```

### –≠–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è (–ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ "–ö—É–ø–∏—Ç—å")
```tsx
<div className="fixed inset-0 bg-black/90 flex items-center justify-center">
  <div className="text-center">
    <Spinner />
    <p className="text-white mt-4">–û–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã...</p>
    <p className="text-zinc-400 text-sm mt-2">
      –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
    </p>
    <button className="mt-4 text-yellow-500" onClick={checkStatus}>
      –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    </button>
  </div>
</div>
```

---

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|----------|-----------|--------|
| –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | üêõ –í —Ä–∞–±–æ—Ç–µ |
| Webhook –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–π—Ç–∏ (—Ä–µ–¥–∫–æ) | –°—Ä–µ–¥–Ω–∏–π | ‚è≥ –ù—É–∂–µ–Ω retry –º–µ—Ö–∞–Ω–∏–∑–º |
| –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è webhook | –°—Ä–µ–¥–Ω–∏–π | ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ |
| –ù–µ—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π | –ù–∏–∑–∫–∏–π | ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ |

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø LAVA.TOP

**API Docs:** https://dev.lava.top/docs (–ø—Ä–∏–º–µ—Ä–Ω—ã–π URL, —É—Ç–æ—á–Ω–∏—Ç—å)

**–ö–ª—é—á–µ–≤—ã–µ endpoints:**
- `POST /invoice/create` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å—á—ë—Ç
- `GET /invoice/{order_id}` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- Webhook URL ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Lava

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **Deep link** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç —á–µ—Ä–µ–∑ success_url (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
2. **Polling** ‚Äî –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
3. **Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏, –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ AR
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ webhook_logs
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ iOS/Android
6. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (—Å–º. roadmap/ADMIN.md)

---

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ:**
- Backend (Webhook, RPC): –ê–Ω—è
- Frontend (UI, polling): –í–∞–ª–µ—Ä–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Lava: (—É—Ç–æ—á–Ω–∏—Ç—å, –∫—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª)
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è: –ê–ª–µ–∫—Å–∞–Ω–¥—Ä
