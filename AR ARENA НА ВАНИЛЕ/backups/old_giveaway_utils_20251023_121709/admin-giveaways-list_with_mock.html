<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Розыгрыши - AR ARENA Admin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="admin-section-header.js"></script>
    <style id="section-header-styles"></style>
    <style>
        /* ТУТ СТИЛИ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: white;
            padding: 16px 12px 90px;
        }

        /* CREATE BUTTON */
        .create-btn {
            width: 100%;
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #FFD700;
            border-radius: 16px;
            padding: 18px;
            font-size: 17px;
            font-weight: 700;
            color: #FFD700;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .create-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
        }

        .tab {
            flex: 1;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab:hover {
            border-color: rgba(255, 215, 0, 0.4);
            color: rgba(255, 255, 255, 0.8);
        }

        .tab.active {
            background: rgba(255, 215, 0, 0.15);
            color: #FFD700;
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        /* GIVEAWAY CARD */
        .giveaway-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 18px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .giveaway-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255,215,0,0.3);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 16px;
            position: relative;
            padding-right: 60px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }

        .card-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.5);
            line-height: 1.4;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: linear-gradient(135deg, rgba(56, 239, 125, 0.2), rgba(56, 239, 125, 0.1));
            color: #38EF7D;
            border: 1px solid rgba(56, 239, 125, 0.3);
        }

        .status-ended {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.1));
            color: #FF6B35;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }

        .card-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-item {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 12px;
        }

        .stat-label {
            color: rgba(255,255,255,0.5);
            font-size: 11px;
            margin-bottom: 4px;
        }

        .stat-value {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 3px;
            position: absolute;
            top: 0;
            right: 0;
        }

        .action-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            width: 24px;
            height: 24px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .action-btn svg {
            width: 12px;
            height: 12px;
            stroke: rgba(255,255,255,0.7);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .action-btn:hover {
            background: rgba(255,215,0,0.1);
            border-color: #FFD700;
        }

        .action-btn:hover svg {
            stroke: #FFD700;
        }

        .action-btn.delete:hover {
            background: rgba(239,68,68,0.1);
            border-color: #ef4444;
        }

        .action-btn.delete:hover svg {
            stroke: #ef4444;
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: linear-gradient(135deg, rgba(30, 20, 10, 0.5), rgba(20, 20, 20, 0.7));
            border: 2px dashed rgba(255, 215, 0, 0.2);
            border-radius: 18px;
        }

        .empty-icon {
            width: 100px;
            margin-bottom: 24px;
            opacity: 0.4;
            filter: drop-shadow(0 4px 12px rgba(255, 215, 0, 0.2));
        }

        .empty-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 24px;
            font-weight: 500;
        }

        @media (max-width: 400px) {
            .giveaway-card {
                padding: 16px;
            }

            .card-stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <script>
        // Вставка компактного хедера раздела
        document.getElementById('section-header-styles').textContent = sectionHeaderStyles;
        document.body.insertAdjacentHTML('afterbegin', createSectionHeader('Розыгрыши', 'admin.html'));
    </script>

    <!-- CREATE BUTTON -->
    <button class="create-btn" onclick="window.location.href='admin-giveaway.html'">
        + Новый розыгрыш
    </button>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab active" onclick="filterGiveaways('all')">Все</button>
        <button class="tab" onclick="filterGiveaways('active')">Активные</button>
        <button class="tab" onclick="filterGiveaways('ended')">Завершённые</button>
    </div>

    <!-- GIVEAWAYS LIST -->
    <div id="giveaways-list">
        <!-- Карточки будут здесь -->
    </div>

    <!-- EMPTY STATE (показывать если список пуст) -->
    <div class="empty-state" id="empty-state" style="display: none;">
        <img src="icons/barrel.png" class="empty-icon" alt="Empty">
        <div class="empty-text">Розыгрышей пока нет</div>
        <button class="create-btn" onclick="window.location.href='admin-giveaway.html'" style="margin-top: 8px;">
            + Создать первый розыгрыш
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="auth.js"></script>

    <script>
        // Telegram WebApp
        const tg = window.Telegram?.WebApp;
        tg?.ready();
        tg?.expand();

        // MOCK DATA (потом заменить на загрузку из Supabase)
        const mockGiveaways = [
            {
                id: 1,
                title: 'Новогодний розыгрыш 2025',
                prize: '50,000₽',
                participants: 127,
                tickets: 500,
                endDate: new Date('2025-12-31'),
                status: 'active'
            },
            {
                id: 2,
                title: 'Летний розыгрыш iPhone',
                prize: 'iPhone 15 Pro',
                participants: 89,
                tickets: 234,
                endDate: new Date('2025-06-30'),
                status: 'ended'
            }
        ];

        // Загрузка розыгрышей
        function loadGiveaways(filter = 'all') {
            const list = document.getElementById('giveaways-list');
            const emptyState = document.getElementById('empty-state');

            let filtered = mockGiveaways;
            if (filter === 'active') {
                filtered = mockGiveaways.filter(g => g.status === 'active');
            } else if (filter === 'ended') {
                filtered = mockGiveaways.filter(g => g.status === 'ended');
            }

            if (filtered.length === 0) {
                list.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            list.innerHTML = filtered.map(g => `
                <div class="giveaway-card">
                    <div class="card-header">
                        <div>
                            <div class="status-badge ${g.status === 'active' ? 'status-active' : 'status-ended'}">
                                ${g.status === 'active' ? 'Активен' : 'Завершён'}
                            </div>
                            <div class="card-title">${g.title}</div>
                            <div class="card-subtitle">Приз: ${g.prize}</div>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn" onclick="editGiveaway(${g.id})" title="Изменить">
                                <svg viewBox="0 0 24 24">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="action-btn delete" onclick="deleteGiveaway(${g.id})" title="Удалить">
                                <svg viewBox="0 0 24 24">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <div class="stat-label">Участников</div>
                            <div class="stat-value">${g.participants}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Билетов</div>
                            <div class="stat-value">${g.tickets}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Осталось</div>
                            <div class="stat-value">${getTimeLeft(g.endDate)}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Приз</div>
                            <div class="stat-value" style="font-size: 14px;">${g.prize}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getTimeLeft(endDate) {
            const now = new Date();
            const diff = endDate - now;
            if (diff < 0) return 'Завершён';

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            return `Через ${days}д ${hours}ч`;
        }

        function filterGiveaways(filter) {
            // Переключение активного таба
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            loadGiveaways(filter);
        }

        function openGiveaway(id) {
            console.log('Opening giveaway:', id);
            // TODO: Открыть страницу деталей розыгрыша
            alert(`Открыть детали розыгрыша #${id}`);
        }

        function editGiveaway(id) {
            console.log('Editing giveaway:', id);
            window.location.href = `admin-giveaway.html?id=${id}`;
        }

        function deleteGiveaway(id) {
            if (confirm('Удалить розыгрыш? Это действие нельзя отменить.')) {
                console.log('Deleting giveaway:', id);
                // TODO: API вызов для удаления
                alert('Розыгрыш удалён');
                loadGiveaways();
            }
        }

        function endGiveaway(id) {
            if (confirm('Завершить розыгрыш досрочно?')) {
                console.log('Ending giveaway:', id);
                // TODO: API вызов
                alert('Розыгрыш завершён');
                loadGiveaways();
            }
        }

        // Загрузка при открытии
        loadGiveaways();
    </script>
</body>
</html>
