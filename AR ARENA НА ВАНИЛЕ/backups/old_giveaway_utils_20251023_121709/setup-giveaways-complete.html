<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR ARENA - Setup Giveaways COMPLETE</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #FFD700; margin-bottom: 20px; font-size: 36px; text-align: center; }
        .card {
            background: rgba(20,20,20,0.8);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,215,0,0.2);
        }
        .btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-success { background: linear-gradient(135deg, #38EF7D, #11998E); }
        .btn-danger { background: linear-gradient(135deg, #FF6B35, #F7931E); }
        .sql-box {
            background: #000;
            padding: 20px;
            border-radius: 12px;
            font-family: Monaco, monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            border: 2px solid #FFD700;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #FFD700;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .copy-btn:hover { background: #FFA500; }
        .step {
            background: rgba(255,215,0,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #FFD700;
        }
        .step-number {
            display: inline-block;
            background: #FFD700;
            color: #000;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .step h3 { color: #FFD700; margin-bottom: 10px; }
        .status {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        .status-item {
            flex: 1;
            min-width: 200px;
            background: rgba(255,215,0,0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,215,0,0.3);
            text-align: center;
        }
        .status-label { color: #999; font-size: 12px; margin-bottom: 5px; }
        .status-value { color: #FFD700; font-size: 24px; font-weight: bold; }
        .status-value.success { color: #38EF7D; }
        .status-value.error { color: #FF6B35; }
        #log {
            background: #000;
            padding: 20px;
            border-radius: 12px;
            font-family: Monaco, monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-item { margin-bottom: 8px; padding: 8px; border-radius: 6px; }
        .log-success { color: #38EF7D; background: rgba(56,239,125,0.1); }
        .log-error { color: #FF6B35; background: rgba(255,107,53,0.1); }
        .log-info { color: #4A9EFF; }
        .log-warning { color: #FFA500; }
        .result-card {
            background: linear-gradient(135deg, rgba(56,239,125,0.1), rgba(17,153,142,0.1));
            border: 2px solid #38EF7D;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
        }
        .result-id {
            font-size: 72px;
            color: #38EF7D;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(56,239,125,0.5);
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ AR ARENA - Complete Giveaway Setup</h1>

        <!-- Step 1: Copy SQL -->
        <div class="card" id="step1Card">
            <div class="step">
                <h3><span class="step-number">1</span> Copy SQL Schema</h3>
                <p style="color: #999; margin-bottom: 15px;">
                    Copy the SQL schema below to your clipboard:
                </p>
                <div class="sql-box" id="sqlBox">
<button class="copy-btn" onclick="copySQL()">Copy SQL</button>
Loading SQL...</div>
                <button class="btn" onclick="copySQL()">üìã Copy SQL to Clipboard</button>
            </div>
        </div>

        <!-- Step 2: Execute in Supabase -->
        <div class="card" id="step2Card">
            <div class="step">
                <h3><span class="step-number">2</span> Execute in Supabase SQL Editor</h3>
                <p style="color: #999; margin-bottom: 15px;">
                    1. Click button below to open Supabase SQL Editor<br>
                    2. Paste the SQL (Ctrl+V / Cmd+V)<br>
                    3. Click RUN button in Supabase<br>
                    4. Come back here and click "I executed the SQL"
                </p>
                <button class="btn" onclick="openSupabase()">üöÄ Open Supabase SQL Editor</button>
                <button class="btn btn-success" onclick="verifyTables()" style="margin-top: 10px;">‚úÖ I executed the SQL - Verify Tables</button>
            </div>
        </div>

        <!-- Status -->
        <div class="card">
            <h3 style="color: #FFD700; margin-bottom: 15px;">üìä Status</h3>
            <div class="status">
                <div class="status-item">
                    <div class="status-label">Tables Created</div>
                    <div class="status-value" id="tablesCount">0/4</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Giveaway Created</div>
                    <div class="status-value" id="giveawayStatus">No</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Giveaway ID</div>
                    <div class="status-value" id="giveawayIdStatus">‚Äî</div>
                </div>
            </div>
        </div>

        <!-- Result -->
        <div class="result-card" id="resultCard">
            <h2 style="color: #38EF7D; margin-bottom: 10px;">‚úÖ SETUP COMPLETE!</h2>
            <div class="result-id" id="finalGiveawayId">‚Äî</div>
            <div style="color: #999; font-size: 16px; margin-bottom: 20px;">Giveaway ID</div>
            <div style="color: #fff; font-size: 18px; line-height: 1.6;">
                <strong>Test Giveaway Created:</strong><br>
                Prize: 50000 AR<br>
                Ticket Price: 100 AR<br>
                Max Tickets: 500<br>
                End Date: October 19, 2025 20:00 UTC
            </div>
        </div>

        <!-- Log -->
        <div class="card">
            <h3 style="color: #FFD700; margin-bottom: 15px;">üìù Execution Log</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const supabase = window.supabase.createClient(
            'https://syxjkircmiwpnpagznay.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5eGpraXJjbWl3cG5wYWd6bmF5Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1Nzc2NDQxMSwiZXhwIjoyMDczMzQwNDExfQ.7ueEYBhFrxKU3_RJi_iJEDj6EQqWBy3gAXiM4YIALqs'
        );

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-item log-${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('log').appendChild(div);
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
            console.log(msg);
        }

        async function loadSQL() {
            try {
                log('üì• Loading giveaway_schema.sql...', 'info');
                const response = await fetch('giveaway_schema.sql');
                const sql = await response.text();
                document.getElementById('sqlBox').innerHTML = `<button class="copy-btn" onclick="copySQL()">Copy SQL</button>${sql}`;
                log('‚úÖ SQL schema loaded successfully', 'success');
            } catch (err) {
                log(`‚ùå Error loading SQL: ${err.message}`, 'error');
            }
        }

        function copySQL() {
            const sqlBox = document.getElementById('sqlBox');
            const text = sqlBox.textContent.replace('Copy SQL', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                log('‚úÖ SQL copied to clipboard!', 'success');
                alert('‚úÖ SQL copied to clipboard!\n\nNow:\n1. Click "Open Supabase SQL Editor"\n2. Paste SQL\n3. Click RUN\n4. Come back and click "I executed the SQL"');
            }).catch(err => {
                log(`‚ùå Copy failed: ${err.message}`, 'error');
            });
        }

        function openSupabase() {
            log('üöÄ Opening Supabase SQL Editor...', 'info');
            window.open('https://supabase.com/dashboard/project/syxjkircmiwpnpagznay/sql/new', '_blank');
        }

        async function verifyTables() {
            log('üîç Verifying tables...', 'info');

            const tablesToCheck = ['giveaways', 'giveaway_tickets', 'giveaway_referrals', 'giveaway_purchases'];
            let foundCount = 0;

            for (const tableName of tablesToCheck) {
                try {
                    const { data, error } = await supabase
                        .from(tableName)
                        .select('count', { count: 'exact', head: true });

                    if (!error) {
                        log(`‚úÖ Table exists: ${tableName}`, 'success');
                        foundCount++;
                    } else {
                        log(`‚ùå Table missing: ${tableName}`, 'error');
                    }
                } catch (err) {
                    log(`‚ùå Cannot verify ${tableName}: ${err.message}`, 'error');
                }
            }

            document.getElementById('tablesCount').textContent = `${foundCount}/4`;
            document.getElementById('tablesCount').className = foundCount === 4 ? 'status-value success' : 'status-value error';

            if (foundCount === 4) {
                log('üéâ All 4 tables verified!', 'success');
                log('üìù Creating test giveaway...', 'info');
                await createTestGiveaway();
            } else {
                log(`‚ö†Ô∏è  Only ${foundCount}/4 tables found. Please execute SQL in Supabase first.`, 'warning');
                alert(`‚ö†Ô∏è  Only ${foundCount}/4 tables found.\n\nPlease:\n1. Open Supabase SQL Editor\n2. Paste the SQL\n3. Click RUN\n4. Come back and try again`);
            }
        }

        async function createTestGiveaway() {
            try {
                const giveawayData = {
                    title: '–î–µ–Ω–µ–∂–Ω—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à 50000 AR',
                    description: '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à –Ω–∞ 50000 AR –º–æ–Ω–µ—Ç. –ö—É–ø–∏—Ç–µ –±–∏–ª–µ—Ç –∑–∞ 100 AR –∏ —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ! –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç 50000 AR –º–æ–Ω–µ—Ç –Ω–∞ —Å–≤–æ–π —Å—á—ë—Ç.',
                    prize_description: '50000 AR –º–æ–Ω–µ—Ç –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å',
                    prize_ar: 50000,
                    prize_image_url: null,
                    start_date: new Date().toISOString(),
                    end_date: '2025-10-19T20:00:00+00:00',
                    status: 'active',
                    ticket_price_ar: 100,
                    max_tickets: 500,
                    sold_tickets: 0
                };

                log('üíæ Inserting giveaway into database...', 'info');

                const { data, error } = await supabase
                    .from('giveaways')
                    .insert([giveawayData])
                    .select();

                if (error) {
                    log(`‚ùå Error creating giveaway: ${error.message}`, 'error');
                    document.getElementById('giveawayStatus').textContent = 'Error';
                    document.getElementById('giveawayStatus').className = 'status-value error';
                    return;
                }

                const giveawayId = data[0].id;
                log(`‚úÖ Giveaway created successfully! ID: ${giveawayId}`, 'success');
                log(`üìä Prize: ${data[0].prize_ar} AR`, 'info');
                log(`üé´ Ticket price: ${data[0].ticket_price_ar} AR`, 'info');
                log(`üìÖ End date: ${new Date(data[0].end_date).toLocaleString()}`, 'info');

                document.getElementById('giveawayStatus').textContent = 'Yes';
                document.getElementById('giveawayStatus').className = 'status-value success';
                document.getElementById('giveawayIdStatus').textContent = giveawayId;
                document.getElementById('giveawayIdStatus').className = 'status-value success';
                document.getElementById('finalGiveawayId').textContent = giveawayId;
                document.getElementById('resultCard').style.display = 'block';

                log('üéâ SETUP COMPLETE!', 'success');
                log('‚úÖ All tables created', 'success');
                log('‚úÖ Test giveaway created', 'success');
                log(`‚úÖ Giveaway ID: ${giveawayId}`, 'success');

            } catch (err) {
                log(`‚ùå Exception: ${err.message}`, 'error');
                console.error(err);
            }
        }

        // Auto-load SQL on page load
        window.addEventListener('load', () => {
            log('üöÄ AR ARENA Giveaway Setup started', 'info');
            log('üìã Step 1: Load SQL schema', 'info');
            loadSQL();
        });
    </script>
</body>
</html>
