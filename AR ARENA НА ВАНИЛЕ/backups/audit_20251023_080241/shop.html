<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR SHOP</title>
    <link rel="stylesheet" href="shop-styles.css?v=20251013">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è) -->
        <div class="products-section">
            <div class="products-row" id="productsContainer">
                <!-- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –ë–∏–ª–µ—Ç—ã -->
                <div class="product-card tickets small" onclick="window.location.href='buy-tickets.html'">
                    <div class="product-icon">
                        <img src="icons/tiket.png" alt="–ë–∏–ª–µ—Ç—ã" style="width: 60px; height: 60px; object-fit: contain;">
                    </div>
                    <div class="product-content">
                        <h3 class="product-title" style="font-size: 15px;">–ë–∏–ª–µ—Ç—ã –ª–æ—Ç–µ—Ä–µ–∏</h3>
                        <p class="product-desc">–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π –ª–æ—Ç–µ—Ä–µ–µ</p>
                        <div class="product-price">–æ—Ç 100 AR</div>
                    </div>
                    <button class="product-button" onclick="event.stopPropagation(); window.location.href='buy-tickets.html'">
                        –ö—É–ø–∏—Ç—å
                    </button>
                </div>

                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div id="loadingIndicator" style="grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.5);">
                    <div style="font-size: 24px; margin-bottom: 10px;">‚è≥</div>
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal()">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
    <nav class="bottom-navigation">
        <div class="nav-item" onclick="window.location.href='index.html'">
            <img src="icons/main.png" alt="–ì–ª–∞–≤–Ω–∞—è" class="nav-icon">
            <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <div class="nav-item" onclick="window.location.href='tasks.html'">
            <img src="icons/todo.png" alt="–ó–∞–¥–∞–Ω–∏—è" class="nav-icon">
            <span class="nav-label">–ó–∞–¥–∞–Ω–∏—è</span>
        </div>
        <div class="nav-item" onclick="window.location.href='games.html'">
            <img src="icons/gamepad.png" alt="–ò–≥—Ä—ã" class="nav-icon">
            <span class="nav-label">–ò–≥—Ä—ã</span>
        </div>
        <div class="nav-item active" onclick="window.location.href='shop.html'">
            <img src="icons/SHOP.png" alt="–ú–∞–≥–∞–∑–∏–Ω" class="nav-icon">
            <span class="nav-label">–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
        <div class="nav-item" onclick="window.location.href='admin.html?v=20251007'">
            <img src="icons/admin.png" alt="–ê–¥–º–∏–Ω" class="nav-icon">
            <span class="nav-label">–ê–¥–º–∏–Ω</span>
        </div>
    </nav>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º auth.js -->
    <script src="auth.js?v=1759200000"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º shop.js -->
    <script src="shop.js?v=20251013"></script>

    <script>
        // ==========================================
        // –†–ï–ù–î–ï–† –ü–†–û–î–£–ö–¢–û–í –ò–ó SUPABASE
        // ==========================================

        function renderProducts(products) {
            const container = document.getElementById('productsContainer');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const ticketsCard = container.querySelector('.product-card.tickets');

            // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            if (loadingIndicator) {
                loadingIndicator.remove();
            }

            if (!products || products.length === 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                const emptyMessage = document.createElement('div');
                emptyMessage.style.cssText = 'grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.5);';
                emptyMessage.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                    <div>–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                `;
                container.appendChild(emptyMessage);
                return;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ—Å–ª–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –±–∏–ª–µ—Ç–∞–º–∏
            products.forEach(product => {
                const card = createProductCard(product);
                container.appendChild(card);
            });

            console.log(`‚úÖ –û—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–æ ${products.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤`);
        }

        function createProductCard(product) {
            const card = document.createElement('div');

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let categoryClass = 'premium';
            if (product.category === 'futures') categoryClass = 'futures';
            if (product.category === 'test') categoryClass = 'test';

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let iconSrc = 'icons/SPOT.png';
            if (product.category === 'futures') iconSrc = 'icons/—Ö10.png';
            if (product.category === 'test') iconSrc = 'icons/arcoin.png?v=20251023';

            card.className = `product-card ${categoryClass} small`;
            card.innerHTML = `
                <div class="product-icon">
                    <img src="${iconSrc}" alt="${product.title}" style="width: 60px; height: 60px; object-fit: contain;">
                </div>
                <div class="product-content">
                    <h3 class="product-title" style="font-size: 15px;">${product.title}</h3>
                    <p class="product-desc">${product.description || ''}</p>
                    <div class="product-price">${product.price_ar} AR${product.duration_days ? '/' + product.duration_days + ' –¥–Ω' : ''}</div>
                </div>
                <button class="product-button" onclick="window.handleBuyProduct('${product.id}', ${product.price_ar})">
                    ${product.category === 'test' ? '–ö—É–ø–∏—Ç—å —Ç–µ—Å—Ç' : '–ü–æ–¥—Ä–æ–±–Ω–µ–µ'}
                </button>
            `;

            return card;
        }

        // ==========================================
        // –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–ö–£–ü–ö–ò
        // ==========================================

        async function handleBuyProduct(productId, price) {
            console.log(`üõí –ö–ª–∏–∫ –Ω–∞ –ø–æ–∫—É–ø–∫—É: ${productId}, ${price} AR`);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ shop.js
            if (typeof window.shopFunctions !== 'undefined' && window.shopFunctions.buyProduct) {
                await window.shopFunctions.buyProduct(productId, price);
            } else {
                console.error('‚ùå shop.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–ª–∏ buyProduct –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        }

        // ==========================================
        // –ü–û–î–ü–ò–°–ö–ê –ù–ê –ó–ê–ì–†–£–ó–ö–£ –ü–†–û–î–£–ö–¢–û–í –ò–ó SHOP.JS
        // ==========================================

        // –ñ–¥—ë–º –ø–æ–∫–∞ shop.js –∑–∞–≥—Ä—É–∑–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã
        function waitForProducts() {
            if (window.shopFunctions && window.shopFunctions.loadProducts) {
                console.log('‚úÖ Shop.js –≥–æ—Ç–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã...');

                // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã (–æ–Ω–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ shop.js)
                setTimeout(async () => {
                    try {
                        const products = await window.shopFunctions.loadProducts();
                        renderProducts(products);
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:', error);
                        document.getElementById('productsContainer').innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: rgba(255, 100, 100, 0.7);">
                                <div style="font-size: 48px; margin-bottom: 10px;">‚ùå</div>
                                <div>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                                <button onclick="location.reload()" style="margin-top: 20px; padding: 16px 32px; background: linear-gradient(135deg, #FFD700, #FFA500); border: none; border-radius: 12px; color: #000; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); transition: all 0.3s;">
                                    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                                </button>
                            </div>
                        `;
                    }
                }, 100);
            } else {
                console.log('‚è≥ –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ shop.js...');
                setTimeout(waitForProducts, 300);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                waitForProducts();
            });
        } else {
            waitForProducts();
        }

        // ==========================================
        // –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        // ==========================================

        function showModal(type) {
            const modal = document.getElementById('productModal');
            const modalBody = document.getElementById('modalBody');

            let content = '';

            if (type === 'spot') {
                content = `
                    <div class="modal-header">
                        <img src="icons/SPOT.png" alt="SPOT" style="width: 80px; height: 80px; object-fit: contain;">
                        <h2>–ö–õ–£–ë –°–ü–û–¢ —Ç–æ—Ä–≥–æ–≤–ª–∏</h2>
                    </div>
                    <div class="modal-description">
                        <h3>–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:</h3>
                        <ul>
                            <li>–û–±—É—á–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º –≤ –¢–û–ü –º–æ–Ω–µ—Ç—ã</li>
                            <li>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–ø–æ—Ç–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</li>
                            <li>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä—ã–Ω–∫–∞</li>
                            <li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</li>
                            <li>–î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É –∫–∞–Ω–∞–ª—É</li>
                            <li>ROI >85% –Ω–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏</li>
                        </ul>
                    </div>
                    <div class="modal-price">2000 AR/–º–µ—Å—è—Ü</div>
                    <button class="modal-button" onclick="window.open('https://premium-ar.com/', '_blank')">
                        –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
                    </button>
                `;
            } else if (type === 'futures') {
                content = `
                    <div class="modal-header">
                        <img src="icons/—Ö10.png" alt="Futures" style="width: 80px; height: 80px; object-fit: contain;">
                        <h2>–¢–æ—Ä–≥–æ–≤–ª—è –Ω–∞ —Ñ—å—é—á–µ—Ä—Å–∞—Ö</h2>
                    </div>
                    <div class="modal-description">
                        <h3>–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:</h3>
                        <ul>
                            <li>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</li>
                            <li>–¢–æ—á–Ω–æ—Å—Ç—å –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ >85%</li>
                            <li>–†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç</li>
                            <li>–û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</li>
                            <li>VIP —á–∞—Ç —Ç—Ä–µ–π–¥–µ—Ä–æ–≤</li>
                            <li>–ö–æ–º–∞–Ω–¥–∞ —Å –æ–ø—ã—Ç–æ–º 8+ –ª–µ—Ç</li>
                        </ul>
                    </div>
                    <div class="modal-price">1500 AR/–º–µ—Å—è—Ü</div>
                    <button class="modal-button" onclick="window.open('https://www.ar-premium.com/', '_blank')">
                        –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
                    </button>
                `;
            }

            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('productModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>